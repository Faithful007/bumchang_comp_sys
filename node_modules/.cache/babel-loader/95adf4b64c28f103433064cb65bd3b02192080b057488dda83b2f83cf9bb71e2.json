{"ast":null,"code":"// src/utils/speedGradeTables.js\n// Centralized registry and helpers for pollutant speed–grade f_iv tables.\n// Import JSON once here; use from anywhere via exported helpers.\n\nimport pmTable from \"./pmSpeedGradeFiv.json\";\nimport coTable from \"./coSpeedGradeFiv.json\";\nimport noxTable from \"./noxSpeedGradeFiv.json\";\n\n// Pollutant -> table mapping\nexport const SPEED_GRADE_TABLES = Object.freeze({\n  PM: pmTable,\n  CO: coTable,\n  NOx: noxTable\n});\n\n// Canonical vehicle classes (keys should be the same across pollutants)\nexport const VEHICLE_CLASSES = Object.freeze([{\n  key: \"gasoline_passenger\",\n  label: \"휘발유 승용차\"\n}, {\n  key: \"diesel_passenger\",\n  label: \"경유 승용차\"\n}, {\n  key: \"small_bus_truck\",\n  label: \"소형버스·소형트럭\"\n}, {\n  key: \"large_bus_and_heavy_truck\",\n  label: \"대형버스·중형·대형·특수트럭\"\n}]);\nexport function getTable(pollutant) {\n  const t = SPEED_GRADE_TABLES[pollutant];\n  if (!t) throw new Error(`Unknown pollutant table: ${pollutant}`);\n  return t;\n}\nexport function getSpeeds(pollutant) {\n  var _getTable$metadata;\n  return ((_getTable$metadata = getTable(pollutant).metadata) === null || _getTable$metadata === void 0 ? void 0 : _getTable$metadata.speeds_kmh) || [];\n}\nexport function getGrades(pollutant) {\n  var _getTable$metadata2;\n  return ((_getTable$metadata2 = getTable(pollutant).metadata) === null || _getTable$metadata2 === void 0 ? void 0 : _getTable$metadata2.grades_percent) || [];\n}\nexport function getVehicleClassesFromTable(pollutant) {\n  const tbl = getTable(pollutant);\n  return Object.keys(tbl.vehicle_classes || {});\n}\nexport function getFivGrid(pollutant, vehicleClassKey) {\n  var _tbl$vehicle_classes;\n  const tbl = getTable(pollutant);\n  const cls = (_tbl$vehicle_classes = tbl.vehicle_classes) === null || _tbl$vehicle_classes === void 0 ? void 0 : _tbl$vehicle_classes[vehicleClassKey];\n  if (!cls) throw new Error(`Unknown class ${vehicleClassKey} for ${pollutant}`);\n  return cls.fiv_table;\n}\n\n/**\r\n * Get f_iv value with speed snap + grade interpolation.\r\n * Matches Excel logic: nearest speed, linear interpolation on grade.\r\n * \r\n * @param {string} pollutant - \"PM\", \"CO\", or \"NOx\"\r\n * @param {string} vehicleClassKey - vehicle class key\r\n * @param {number} speedKmh - speed in km/h\r\n * @param {number} gradePercent - grade in %\r\n * @returns {number} f_iv correction factor\r\n */\nexport function getFivValue(pollutant, vehicleClassKey, speedKmh, gradePercent) {\n  const speeds = getSpeeds(pollutant);\n  const grades = getGrades(pollutant);\n  const grid = getFivGrid(pollutant, vehicleClassKey);\n  const v = Number(speedKmh);\n  const i = Number(gradePercent);\n  if (!Number.isFinite(v) || !Number.isFinite(i)) return NaN;\n\n  // Snap to nearest speed\n  let speedIdx = 0;\n  let minDist = Infinity;\n  speeds.forEach((s, idx) => {\n    const dist = Math.abs(v - s);\n    if (dist < minDist) {\n      minDist = dist;\n      speedIdx = idx;\n    }\n  });\n\n  // Interpolate grade\n  const iFloor = Math.floor(i);\n  const iCeil = iFloor + 1;\n  let colLow = grades.indexOf(iFloor);\n  let colHigh = grades.indexOf(iCeil);\n\n  // Clamp if out of range\n  if (colLow === -1) {\n    let best = 0;\n    grades.forEach((g, idx) => {\n      if (g <= i) best = idx;\n    });\n    colLow = best;\n  }\n  if (colHigh === -1) {\n    colHigh = Math.min(colLow + 1, grades.length - 1);\n  }\n  const fLow = grid[speedIdx][colLow];\n  const fHigh = grid[speedIdx][colHigh];\n  if (colLow === colHigh) return Number(fLow.toFixed(4));\n  const t = (i - grades[colLow]) / (grades[colHigh] - grades[colLow]);\n  const f = fLow + (fHigh - fLow) * t;\n  return Number(f.toFixed(4));\n}","map":{"version":3,"names":["pmTable","coTable","noxTable","SPEED_GRADE_TABLES","Object","freeze","PM","CO","NOx","VEHICLE_CLASSES","key","label","getTable","pollutant","t","Error","getSpeeds","_getTable$metadata","metadata","speeds_kmh","getGrades","_getTable$metadata2","grades_percent","getVehicleClassesFromTable","tbl","keys","vehicle_classes","getFivGrid","vehicleClassKey","_tbl$vehicle_classes","cls","fiv_table","getFivValue","speedKmh","gradePercent","speeds","grades","grid","v","Number","i","isFinite","NaN","speedIdx","minDist","Infinity","forEach","s","idx","dist","Math","abs","iFloor","floor","iCeil","colLow","indexOf","colHigh","best","g","min","length","fLow","fHigh","toFixed","f"],"sources":["C:/Users/USER/sourcecodes/auto-excel/comp-engine2/src/utils/speedGradeTables.js"],"sourcesContent":["// src/utils/speedGradeTables.js\r\n// Centralized registry and helpers for pollutant speed–grade f_iv tables.\r\n// Import JSON once here; use from anywhere via exported helpers.\r\n\r\nimport pmTable from \"./pmSpeedGradeFiv.json\";\r\nimport coTable from \"./coSpeedGradeFiv.json\";\r\nimport noxTable from \"./noxSpeedGradeFiv.json\";\r\n\r\n// Pollutant -> table mapping\r\nexport const SPEED_GRADE_TABLES = Object.freeze({\r\n  PM: pmTable,\r\n  CO: coTable,\r\n  NOx: noxTable\r\n});\r\n\r\n// Canonical vehicle classes (keys should be the same across pollutants)\r\nexport const VEHICLE_CLASSES = Object.freeze([\r\n  { key: \"gasoline_passenger\", label: \"휘발유 승용차\" },\r\n  { key: \"diesel_passenger\", label: \"경유 승용차\" },\r\n  { key: \"small_bus_truck\", label: \"소형버스·소형트럭\" },\r\n  { key: \"large_bus_and_heavy_truck\", label: \"대형버스·중형·대형·특수트럭\" }\r\n]);\r\n\r\nexport function getTable(pollutant) {\r\n  const t = SPEED_GRADE_TABLES[pollutant];\r\n  if (!t) throw new Error(`Unknown pollutant table: ${pollutant}`);\r\n  return t;\r\n}\r\n\r\nexport function getSpeeds(pollutant) {\r\n  return getTable(pollutant).metadata?.speeds_kmh || [];\r\n}\r\n\r\nexport function getGrades(pollutant) {\r\n  return getTable(pollutant).metadata?.grades_percent || [];\r\n}\r\n\r\nexport function getVehicleClassesFromTable(pollutant) {\r\n  const tbl = getTable(pollutant);\r\n  return Object.keys(tbl.vehicle_classes || {});\r\n}\r\n\r\nexport function getFivGrid(pollutant, vehicleClassKey) {\r\n  const tbl = getTable(pollutant);\r\n  const cls = tbl.vehicle_classes?.[vehicleClassKey];\r\n  if (!cls) throw new Error(`Unknown class ${vehicleClassKey} for ${pollutant}`);\r\n  return cls.fiv_table;\r\n}\r\n\r\n/**\r\n * Get f_iv value with speed snap + grade interpolation.\r\n * Matches Excel logic: nearest speed, linear interpolation on grade.\r\n * \r\n * @param {string} pollutant - \"PM\", \"CO\", or \"NOx\"\r\n * @param {string} vehicleClassKey - vehicle class key\r\n * @param {number} speedKmh - speed in km/h\r\n * @param {number} gradePercent - grade in %\r\n * @returns {number} f_iv correction factor\r\n */\r\nexport function getFivValue(pollutant, vehicleClassKey, speedKmh, gradePercent) {\r\n  const speeds = getSpeeds(pollutant);\r\n  const grades = getGrades(pollutant);\r\n  const grid = getFivGrid(pollutant, vehicleClassKey);\r\n\r\n  const v = Number(speedKmh);\r\n  const i = Number(gradePercent);\r\n  \r\n  if (!Number.isFinite(v) || !Number.isFinite(i)) return NaN;\r\n\r\n  // Snap to nearest speed\r\n  let speedIdx = 0;\r\n  let minDist = Infinity;\r\n  speeds.forEach((s, idx) => {\r\n    const dist = Math.abs(v - s);\r\n    if (dist < minDist) {\r\n      minDist = dist;\r\n      speedIdx = idx;\r\n    }\r\n  });\r\n\r\n  // Interpolate grade\r\n  const iFloor = Math.floor(i);\r\n  const iCeil = iFloor + 1;\r\n\r\n  let colLow = grades.indexOf(iFloor);\r\n  let colHigh = grades.indexOf(iCeil);\r\n\r\n  // Clamp if out of range\r\n  if (colLow === -1) {\r\n    let best = 0;\r\n    grades.forEach((g, idx) => {\r\n      if (g <= i) best = idx;\r\n    });\r\n    colLow = best;\r\n  }\r\n  \r\n  if (colHigh === -1) {\r\n    colHigh = Math.min(colLow + 1, grades.length - 1);\r\n  }\r\n\r\n  const fLow = grid[speedIdx][colLow];\r\n  const fHigh = grid[speedIdx][colHigh];\r\n\r\n  if (colLow === colHigh) return Number(fLow.toFixed(4));\r\n\r\n  const t = (i - grades[colLow]) / (grades[colHigh] - grades[colLow]);\r\n  const f = fLow + (fHigh - fLow) * t;\r\n\r\n  return Number(f.toFixed(4));\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}