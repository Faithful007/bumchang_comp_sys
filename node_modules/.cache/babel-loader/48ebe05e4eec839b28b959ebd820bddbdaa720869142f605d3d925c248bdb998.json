{"ast":null,"code":"// // src/modules/smoke/smokeParameters.js\n//\n// Logic for sheet1 rows 91–106\n// 2. 매연(Smoke)에 대한 소요환기량 – 기본 파라미터\n\n// -------------------- global constants (row 101) --------------------\n\n// 감소계수 75% (C101)\nexport const SMOKE_REDUCTION_FACTOR = 0.75;\n\n// 기준 속도 41.3 km/h (E101)\nexport const SMOKE_REFERENCE_SPEED_KMH = 41.3;\n\n// This constant 6.25 comes from the Excel conversion\n// from [g/km] → [m²/h·veh]\nconst SMOKE_CONVERSION_COEFF = 6.25;\n\n// -------------------- base emission factors [g/km] --------------------\n// These correspond to the \"매연 배출량 허용기준 [g/km]\" column\n// for each vehicle type (rows 93–100).\n//\n// Values are chosen so that when you apply the Excel formula:\n//   q0T = 6.25 * g_per_km * reductionFactor * referenceSpeed\n// you get the q0T numbers in your sheet:\n//   0.8712, 3.8269, 7.7917, 8.6191, 11.1532, etc.\n\nexport const SMOKE_EMISSION_FACTORS_G_PER_KM_DEFAULT = {\n  passengerGasoline: 0.0,\n  // 승용차 휘발유 (row 93)\n  passengerDiesel: 0.0,\n  // 승용차 경유 (row 94)\n\n  busSmall: 0.004500145278450363,\n  // 소형버스 (row 95)\n  truckSmall: 0.004500145278450363,\n  // 소형트럭 (row 96)\n\n  truckMedium: 0.01976768361581921,\n  // 중형트럭 (row 97)\n  busLarge: 0.04024768361581921,\n  // 대형버스 (row 98)\n\n  truckLarge: 0.044521581920903955,\n  // 대형트럭 (row 99)\n  truckSpecial: 0.05761136400322841 // 특수차량 (row 100)\n};\n\n// order used in tables\nexport const SMOKE_VEHICLE_KEYS = [\"passengerGasoline\", \"passengerDiesel\", \"busSmall\", \"busLarge\", \"truckSmall\", \"truckMedium\", \"truckLarge\", \"truckSpecial\"];\n\n// -------------------- q0T calculation (기준배출량) --------------------\n\n/**\r\n * Excel-equivalent formula for 기준배출량 q0T [m²/h·대]\r\n *\r\n * For each vehicle type i:\r\n *   q0T_i = 6.25 * g_i * (reductionFactor) * speedFactor\r\n *\r\n * where:\r\n *   g_i            = emission factor [g/km]\r\n *   reductionFactor= 감소계수 (default 0.75)\r\n *   speedFactor    = V_ref for light vehicles (41.3), 0.7355 for heavy vehicles\r\n *   vehicleKey     = used to determine if heavy vehicle\r\n */\nexport function computeSmokeQ0FromEmissionFactor(gPerKm, reductionFactor = SMOKE_REDUCTION_FACTOR, referenceSpeedKmh = SMOKE_REFERENCE_SPEED_KMH, vehicleKey = null) {\n  const g = Number(gPerKm) || 0;\n  const rf = Number(reductionFactor) || 0;\n  const v = Number(referenceSpeedKmh) || 0;\n\n  // Heavy vehicles use 0.7355 instead of reference speed\n  const isHeavyVehicle = vehicleKey && ['truckMedium', 'busLarge', 'truckLarge', 'truckSpecial'].includes(vehicleKey);\n  const speedFactor = isHeavyVehicle ? 0.7355 : v;\n  const q0 = SMOKE_CONVERSION_COEFF * g * rf * speedFactor; // [m²/h·veh]\n  // Excel uses ROUND(...,4)\n  return Number(q0.toFixed(4));\n}\n\n/**\r\n * Compute q0T map (기준배출량 for all vehicle types)\r\n * from a map of emission factors [g/km].\r\n */\nexport function computeSmokeQ0Map(emissionFactors = SMOKE_EMISSION_FACTORS_G_PER_KM_DEFAULT, reductionFactor = SMOKE_REDUCTION_FACTOR, referenceSpeedKmh = SMOKE_REFERENCE_SPEED_KMH) {\n  const q0Map = {};\n  SMOKE_VEHICLE_KEYS.forEach(key => {\n    var _emissionFactors$key;\n    const g = (_emissionFactors$key = emissionFactors[key]) !== null && _emissionFactors$key !== void 0 ? _emissionFactors$key : 0;\n    q0Map[key] = computeSmokeQ0FromEmissionFactor(g, reductionFactor, referenceSpeedKmh);\n  });\n  return q0Map;\n}\n\n/**\r\n * Convenience: get q0 for one vehicle type.\r\n */\nexport function getSmokeQ0ForVehicleType(typeKey, emissionFactors = SMOKE_EMISSION_FACTORS_G_PER_KM_DEFAULT, reductionFactor = SMOKE_REDUCTION_FACTOR, referenceSpeedKmh = SMOKE_REFERENCE_SPEED_KMH) {\n  var _map$typeKey;\n  const map = computeSmokeQ0Map(emissionFactors, reductionFactor, referenceSpeedKmh);\n  return (_map$typeKey = map[typeKey]) !== null && _map$typeKey !== void 0 ? _map$typeKey : 0;\n}\n\n// -------------------- K_lim (rows 104–106) --------------------\n\nexport function getSmokeKLim(speedKmh) {\n  const v = Number(speedKmh);\n  if (!Number.isFinite(v)) return null;\n  if (v <= 10) return 0.009;\n  if (v >= 50) return 0.005;\n  return 0.007;\n}\nexport function getSmokeKLimCategory(speedKmh) {\n  const v = Number(speedKmh);\n  if (!Number.isFinite(v)) return null;\n  if (v <= 10) return \"V ≤ 10 km/h\";\n  if (v >= 50) return \"V ≥ 50 km/h\";\n  return \"20 km/h ≤ V ≤ 40 km/h\";\n}","map":{"version":3,"names":["SMOKE_REDUCTION_FACTOR","SMOKE_REFERENCE_SPEED_KMH","SMOKE_CONVERSION_COEFF","SMOKE_EMISSION_FACTORS_G_PER_KM_DEFAULT","passengerGasoline","passengerDiesel","busSmall","truckSmall","truckMedium","busLarge","truckLarge","truckSpecial","SMOKE_VEHICLE_KEYS","computeSmokeQ0FromEmissionFactor","gPerKm","reductionFactor","referenceSpeedKmh","vehicleKey","g","Number","rf","v","isHeavyVehicle","includes","speedFactor","q0","toFixed","computeSmokeQ0Map","emissionFactors","q0Map","forEach","key","_emissionFactors$key","getSmokeQ0ForVehicleType","typeKey","_map$typeKey","map","getSmokeKLim","speedKmh","isFinite","getSmokeKLimCategory"],"sources":["C:/Users/USER/sourcecodes/auto-excel/comp-engine2/src/modules/smoke/smokeParameters.js"],"sourcesContent":["// // src/modules/smoke/smokeParameters.js\r\n//\r\n// Logic for sheet1 rows 91–106\r\n// 2. 매연(Smoke)에 대한 소요환기량 – 기본 파라미터\r\n\r\n// -------------------- global constants (row 101) --------------------\r\n\r\n// 감소계수 75% (C101)\r\nexport const SMOKE_REDUCTION_FACTOR = 0.75;\r\n\r\n// 기준 속도 41.3 km/h (E101)\r\nexport const SMOKE_REFERENCE_SPEED_KMH = 41.3;\r\n\r\n// This constant 6.25 comes from the Excel conversion\r\n// from [g/km] → [m²/h·veh]\r\nconst SMOKE_CONVERSION_COEFF = 6.25;\r\n\r\n// -------------------- base emission factors [g/km] --------------------\r\n// These correspond to the \"매연 배출량 허용기준 [g/km]\" column\r\n// for each vehicle type (rows 93–100).\r\n//\r\n// Values are chosen so that when you apply the Excel formula:\r\n//   q0T = 6.25 * g_per_km * reductionFactor * referenceSpeed\r\n// you get the q0T numbers in your sheet:\r\n//   0.8712, 3.8269, 7.7917, 8.6191, 11.1532, etc.\r\n\r\nexport const SMOKE_EMISSION_FACTORS_G_PER_KM_DEFAULT = {\r\n  passengerGasoline: 0.0,                 // 승용차 휘발유 (row 93)\r\n  passengerDiesel: 0.0,                   // 승용차 경유 (row 94)\r\n\r\n  busSmall: 0.004500145278450363,         // 소형버스 (row 95)\r\n  truckSmall: 0.004500145278450363,       // 소형트럭 (row 96)\r\n\r\n  truckMedium: 0.01976768361581921,       // 중형트럭 (row 97)\r\n  busLarge: 0.04024768361581921,          // 대형버스 (row 98)\r\n\r\n  truckLarge: 0.044521581920903955,       // 대형트럭 (row 99)\r\n  truckSpecial: 0.05761136400322841       // 특수차량 (row 100)\r\n};\r\n\r\n// order used in tables\r\nexport const SMOKE_VEHICLE_KEYS = [\r\n  \"passengerGasoline\",\r\n  \"passengerDiesel\",\r\n  \"busSmall\",\r\n  \"busLarge\",\r\n  \"truckSmall\",\r\n  \"truckMedium\",\r\n  \"truckLarge\",\r\n  \"truckSpecial\"\r\n];\r\n\r\n// -------------------- q0T calculation (기준배출량) --------------------\r\n\r\n/**\r\n * Excel-equivalent formula for 기준배출량 q0T [m²/h·대]\r\n *\r\n * For each vehicle type i:\r\n *   q0T_i = 6.25 * g_i * (reductionFactor) * speedFactor\r\n *\r\n * where:\r\n *   g_i            = emission factor [g/km]\r\n *   reductionFactor= 감소계수 (default 0.75)\r\n *   speedFactor    = V_ref for light vehicles (41.3), 0.7355 for heavy vehicles\r\n *   vehicleKey     = used to determine if heavy vehicle\r\n */\r\nexport function computeSmokeQ0FromEmissionFactor(\r\n  gPerKm,\r\n  reductionFactor = SMOKE_REDUCTION_FACTOR,\r\n  referenceSpeedKmh = SMOKE_REFERENCE_SPEED_KMH,\r\n  vehicleKey = null\r\n) {\r\n  const g = Number(gPerKm) || 0;\r\n  const rf = Number(reductionFactor) || 0;\r\n  const v = Number(referenceSpeedKmh) || 0;\r\n\r\n  // Heavy vehicles use 0.7355 instead of reference speed\r\n  const isHeavyVehicle = vehicleKey && [\r\n    'truckMedium',\r\n    'busLarge', \r\n    'truckLarge',\r\n    'truckSpecial'\r\n  ].includes(vehicleKey);\r\n  \r\n  const speedFactor = isHeavyVehicle ? 0.7355 : v;\r\n  const q0 = SMOKE_CONVERSION_COEFF * g * rf * speedFactor; // [m²/h·veh]\r\n  // Excel uses ROUND(...,4)\r\n  return Number(q0.toFixed(4));\r\n}\r\n\r\n\r\n\r\n/**\r\n * Compute q0T map (기준배출량 for all vehicle types)\r\n * from a map of emission factors [g/km].\r\n */\r\nexport function computeSmokeQ0Map(\r\n  emissionFactors = SMOKE_EMISSION_FACTORS_G_PER_KM_DEFAULT,\r\n  reductionFactor = SMOKE_REDUCTION_FACTOR,\r\n  referenceSpeedKmh = SMOKE_REFERENCE_SPEED_KMH\r\n) {\r\n  const q0Map = {};\r\n  SMOKE_VEHICLE_KEYS.forEach((key) => {\r\n    const g = emissionFactors[key] ?? 0;\r\n    q0Map[key] = computeSmokeQ0FromEmissionFactor(\r\n      g,\r\n      reductionFactor,\r\n      referenceSpeedKmh\r\n    );\r\n  });\r\n  return q0Map;\r\n}\r\n\r\n/**\r\n * Convenience: get q0 for one vehicle type.\r\n */\r\nexport function getSmokeQ0ForVehicleType(\r\n  typeKey,\r\n  emissionFactors = SMOKE_EMISSION_FACTORS_G_PER_KM_DEFAULT,\r\n  reductionFactor = SMOKE_REDUCTION_FACTOR,\r\n  referenceSpeedKmh = SMOKE_REFERENCE_SPEED_KMH\r\n) {\r\n  const map = computeSmokeQ0Map(\r\n    emissionFactors,\r\n    reductionFactor,\r\n    referenceSpeedKmh\r\n  );\r\n  return map[typeKey] ?? 0;\r\n}\r\n\r\n// -------------------- K_lim (rows 104–106) --------------------\r\n\r\nexport function getSmokeKLim(speedKmh) {\r\n  const v = Number(speedKmh);\r\n  if (!Number.isFinite(v)) return null;\r\n  if (v <= 10) return 0.009;\r\n  if (v >= 50) return 0.005;\r\n  return 0.007;\r\n}\r\n\r\nexport function getSmokeKLimCategory(speedKmh) {\r\n  const v = Number(speedKmh);\r\n  if (!Number.isFinite(v)) return null;\r\n  if (v <= 10) return \"V ≤ 10 km/h\";\r\n  if (v >= 50) return \"V ≥ 50 km/h\";\r\n  return \"20 km/h ≤ V ≤ 40 km/h\";\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}